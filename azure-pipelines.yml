trigger:
  - master

pool:
  vmImage: 'Hosted Agent'

variables:
  imageRepository: 'test-repository'
  dockerfilePath: '$(Pipeline.Workspace)/.go_workspace/src/github.com/manjdk/$(imageRepository)/Dockerfile'
  dockerRegistryServiceConnection: MyACRServiceConnection

stages:
  - stage: Build
    displayName: Build and push stage
    jobs:
      - job: Build
        displayName: Build job
        steps:
          - task: Docker@2
            displayName: Build and push an image to container registry
            inputs:
              command: buildAndPush
              repository: $(imageRepository)
              dockerfile: $(dockerfilePath)
              containerRegistry: $(dockerRegistryServiceConnection)
              tags: |
                $(tag)

#  - stage: Deploy
#    displayName: Deploy to App Service
#    jobs:
#      - job: Deploy
#        displayName: Deploy
#        steps:
#          - task: AzureRmWebAppDeployment@4
#        inputs:
#          ConnectionType: 'AzureRM'
#          azureSubscription: 'my-subscription-name'
#          appType: 'webAppHyperVContainer'
#          WebAppName: 'my-app-name'
#          DockerNamespace: 'myregsitry.azurecr.io'
#          DockerRepository: 'dotnetframework:12'